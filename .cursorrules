---
description: 
alwaysApply: true
---

# Ippo Project Cursor Rules
# Swift/SwiftUI iOS + watchOS Tamagotchi-Style Pet Running App

## CRITICAL: Project History and Current Version

This project has gone through THREE versions. Only v3 is active.

### Version History
- **v1 (archived in `_archived_v1/`):** Full pet-collecting running game with 10 pets, ability trees, coins/gems, shop, achievements, IEI zones. Over-scoped.
- **v2 (archived in `_archived_v2/`):** Scoped-down RP box running game. Removed pets, added ranks, friends, groups, weekly leaderboards. Submitted to App Store as "Ippo MVP" Build 39.
- **v3 (CURRENT - active code):** Tamagotchi-style pet running app. Catch fantasy pets during runs, care for them daily (feed, water, pet), watch them evolve through 10 micro-stages. No ranks, no RP, no social features. Warm natural color palette targeting female audience 16-30.

### What to Build From
**BUILD BASED ON:** The plan at `.cursor/plans/ippo_pet_pivot_plan_*.plan.md`
**DO NOT** reference old PRDs (MVP_PRD.md, SCOPED_MVP_PRD.md) for the current version.

### Archive Folders
- `IppoMVP/_archived_v1/` - Original full MVP code (pets, abilities, achievements, shop)
- `IppoMVP/_archived_v2/` - Scoped-down MVP code (ranks, social, RP boxes)
- These folders are NOT compiled. They exist only as reference for future features.

---

## Project Overview

**Ippo** is a Tamagotchi-meets-Pokemon-Go running app:
1. Run with Apple Watch, catch rare fantasy pets during sprint encounters
2. Care for your equipped pet daily (feed, water, pet)
3. Happy pets gain XP faster and evolve through 10 micro-evolution stages
4. Neglected pets get sad, gain XP slower, and eventually run away
5. Coins earned from running buy food, water, boosts, and hibernation items

---

## App Identifiers

| Identifier | Value |
|------------|-------|
| iOS Bundle ID | `com.cruce.IppoMVP` |
| watchOS Bundle ID | `com.cruce.IppoMVP.watchkitapp` |
| App Name (App Store) | `Ippo` |
| Team ID | `HQCUADY3A5` |
| Firebase Project | IppoMVP |

---

## File Organization

### iOS App Structure
```
IppoMVP/IppoMVP/
├── Config/
│   ├── SprintConfig.swift       # Sprint timing and validation thresholds
│   ├── EncounterConfig.swift    # Encounter probability, catch rates
│   ├── PetConfig.swift          # Evolution XP thresholds, mood rules
│   ├── EconomyConfig.swift      # Coin costs, shop prices
│   └── RewardsConfig.swift      # XP/coin amounts per action
├── Core/Types/
│   ├── SprintTypes.swift        # Sprint result types
│   ├── PetTypes.swift           # GamePetDefinition, OwnedPet, PetMood
│   ├── RewardTypes.swift        # RunReward, ShopItem
│   └── PlayerTypes.swift        # PlayerProfile
├── Data/
│   ├── GameData.swift           # 10 pet definitions (static)
│   └── UserData.swift           # User state (pets, coins, care, streak)
├── Engine/
│   ├── Sprint/
│   │   ├── SprintEngine.swift
│   │   └── SprintValidator.swift
│   └── Encounter/
│       └── EncounterManager.swift
├── Services/
│   ├── AuthService.swift
│   ├── CloudService.swift
│   ├── DataPersistence.swift
│   └── WatchConnectivityService.swift
├── Systems/
│   ├── PetSystem.swift          # Evolution, XP, equipping
│   ├── CareSystem.swift         # Feeding, watering, petting, mood
│   ├── CoinSystem.swift         # Earning and spending coins
│   ├── NotificationSystem.swift # Local push notifications
│   ├── RewardsSystem.swift      # Run reward calculation
│   └── LootBoxSystem.swift      # (may be removed/repurposed)
├── UI/
│   ├── Design/
│   │   ├── AppColors.swift      # Warm natural palette
│   │   ├── AppTypography.swift  # SF Rounded
│   │   └── AppSpacing.swift
│   ├── Components/
│   │   ├── PetVideoPlayer.swift # Looping video player
│   │   ├── MoodIndicator.swift  # Leaf-based mood display
│   │   ├── XPProgressBar.swift  # Evolution progress
│   │   └── ...
│   └── Views/
│       ├── HomeView.swift       # Equipped pet + care actions
│       ├── CollectionView.swift # Pet grid + shop access
│       ├── PetDetailView.swift  # Full pet view + evolution timeline
│       ├── ShopSheet.swift      # Shop modal
│       ├── PostRunSummaryView.swift
│       ├── PetRevealView.swift  # Catch reveal animation
│       ├── OnboardingFlow.swift # 8-screen onboarding
│       ├── LoginView.swift
│       ├── ProfileView.swift    # Settings sheet
│       └── AdminDebugView.swift
└── Utils/
    ├── HapticsManager.swift
    └── TelemetryLogger.swift
```

### Watch App Structure
```
IppoMVPWatch Watch App/
├── Engine/
│   └── WatchRunManager.swift    # Run lifecycle, sprint triggers, pet catches
├── Views/
│   ├── WatchContentView.swift
│   ├── WatchStartView.swift     # Start screen with equipped pet
│   ├── WatchRunningView.swift   # Run metrics + pet on scroll
│   ├── WatchSprintView.swift    # Sprint countdown
│   └── WatchSummaryView.swift   # Post-run summary
├── Services/
│   └── WatchConnectivityServiceWatch.swift
└── Utils/
    └── WatchHapticsManager.swift
```

---

## Design System (v3 - Warm Natural)

### Colors
```swift
AppColors.background         // #FFF8F0 (warm cream)
AppColors.surface            // #FFF1E6
AppColors.surfaceElevated    // #FFE8D6
AppColors.textPrimary        // #2D2A26 (warm dark brown)
AppColors.textSecondary      // #6B6560
AppColors.accent             // #E88D5A (warm amber)
AppColors.accentSoft         // #F5C89A
AppColors.success            // #6BBF6B
AppColors.warning            // #E8B44A
AppColors.danger             // #D96B6B
AppColors.coins              // #D4A843
AppColors.xp                 // #7BB8E0 (soft blue)
AppColors.petHappy           // #8BC68B
AppColors.petNeutral         // #E8C86B
AppColors.petSad             // #D98B8B
```

### Typography
- SF Rounded throughout for friendly feel
- Headers: Bold 22-28pt, Body: Regular 16pt, Captions: 13pt

---

## Data Patterns

### GameData (Static - 10 pets)
```swift
GameData.shared.allPets           // 10 GamePetDefinition
GameData.shared.pet(byId: "pet_01")
GameData.shared.starterPets       // First 3 (Lumira, Mossworth, Puddlejoy)
```

### UserData (Dynamic)
```swift
UserData.shared.profile           // PlayerProfile (name, level, xp, coins, streak)
UserData.shared.ownedPets         // [OwnedPet] with mood, XP, evolution stage
UserData.shared.equippedPet       // Currently equipped OwnedPet
UserData.shared.inventory         // Food count, water count, active boosts
```

### Persistence
- Local: UserDefaults via DataPersistence.swift
- Cloud: Firebase Firestore via CloudService.swift
- Watch sync: WatchConnectivityService.swift

---

## Core Game Loops

### Sprint/Encounter System
- Sprint duration: 25-40 seconds (random)
- Validation: HR increase (50%), Cadence (35%), HR derivative (15%)
- Pass threshold: 60% total score
- Each valid sprint: coins + XP + 8% chance to catch a pet
- Pity timer: Guaranteed catch after 15 sprints with no catch

### Pet Care (Daily)
- One care notification per day (2-6pm local, random type: hungry/thirsty/lonely)
- Mood: Happy (3), Content (2), Sad (1) based on running + feeding + petting
- XP multiplier: Happy=1.0x, Content=0.85x, Sad=0.6x
- Pet runs away after ~14 days of total neglect

### Economy
- ~50 coins per 15-min run
- Food: 3 coins, Water: 2 coins
- Boosts: 40-60 coins, Hibernation: 80 coins

---

## Pet Integration Framework

To add a new pet, provide:
1. 10 stage images (PNGs, transparent background)
2. Add one entry to `GameData.shared.allPets` array

```swift
GamePetDefinition(
    id: "pet_XX",
    name: "PetName",
    description: "Full description",
    hintText: "Hint for undiscovered state",
    stageImageNames: ["petname_01", ..., "petname_10"],
    hasIdleVideos: false,
    hasHappyVideos: false
)
```

No other code changes needed per pet.

---

## Code Quality Standards

1. Does it compile?
2. Does the logic work correctly?
3. Does UI exist for all features?
4. Does the UI look professional (warm, cute, polished)?
5. Is the user experience complete?
6. Are all states handled (loading, empty, error)?
7. Would this pass App Store review?

### NO Half-Finished Work
- Every screen needs loading, error, and empty states
- Every action needs visual feedback
- Pet interactions must feel alive and responsive

---

## Communication Style

- **Be proactive** - Suggest improvements, catch issues early
- **Be thorough** - Backend + Frontend + UI + UX + Polish
- **Keep it simple** - 2 tabs, minimal UI, focus on pet interaction
- **Target audience** - Female runners 16-30, cute/warm aesthetic
- **No over-engineering** - Ship fast, iterate later

---

## API Keys (Art Generation)

Keys are stored in `.env.local` (gitignored, never committed). Read that file to get:
- **Nanobanana API key** -- for image generation (Gemini-based, REST API)
- **Higgsfield API key ID + secret** -- for video generation (idle loops, happy animations)

Art guide with prompts: `IppoMVP/PET_ART_GUIDE.md`

---

*Last Updated: February 22, 2026 - v3 Pet Pivot*
